const d=document.getElementById("gotcoords"),u=new MutationObserver(function(t){t.forEach(function(o){if(o.type==="childList"){const e=document.getElementById("latitude").innerText,n=document.getElementById("longitude").innerText;s(e,n)}})});u.observe(d,{childList:!0});const r=(t="false")=>{fetch("https://ipapi.co/json/").then(e=>e.json()).then(e=>(document.getElementById("yourIP").innerHTML=e.ip,t||(document.getElementById("yourLocation").innerHTML=e.city+", "+e.country,document.getElementById("yourLocationLabel").innerHTML="Your aproximated location:",document.getElementById("latitude").innerHTML=e.latitude.toFixed(2),document.getElementById("longitude").innerHTML=e.longitude.toFixed(2),document.getElementById("gotcoords").innerHTML="true",document.getElementById("geolocationinfo").innerHTML="obtained now via IP"),e)).catch(e=>(document.getElementById("yourIP").innerHTML=e,e))},l=(t,o)=>{const e=`https://geocode.maps.co/reverse?lat=${t}&lon=${o}`;fetch(e).then(n=>n.json()).then(n=>{document.getElementById("yourLocationLabel").innerHTML="Your precise location:";const i=n.address.neighbourhood==null?"":n.address.neighbourhood+", ";return document.getElementById("yourLocation").innerHTML=i+n.address.city+", "+n.address.country,n})};function a(){if("geolocation"in navigator){let t=setTimeout(()=>{document.getElementById("geolocationinfo").innerHTML="Couldn't get geolocation. Check permissions on your device.",r()},1e4);navigator.geolocation.getCurrentPosition(o=>{const e=o.coords.latitude.toFixed(2),n=o.coords.longitude.toFixed(2);document.getElementById("latitude").innerHTML=e,document.getElementById("longitude").innerHTML=n,document.getElementById("gotcoords").innerHTML="true",document.getElementById("geolocationinfo").innerHTML="obtained now via geolocation",r(!0),l(o.coords.latitude,o.coords.longitude),clearTimeout(t)})}else document.getElementById("geolocationinfo").innerHTML="Geolocation not available or not allowed by user.",r()}document.getElementById("btGetLocation").addEventListener("click",a);const s=(t,o)=>{localStorage.setItem("savedLocation","true"),localStorage.setItem("latitude",t),localStorage.setItem("longitude",o);const e=`https://api.open-meteo.com/v1/forecast?current_weather=true&latitude=${t}&longitude=${o}&hourly=precipitation_probability&hourly=temperature_2m`;fetch(e).then(n=>n.json()).then(n=>(document.getElementById("URL").innerHTML=e,document.getElementById("temp").innerHTML=n.current_weather.temperature+" Â°C",document.getElementById("rain").innerHTML=n.hourly.precipitation_probability[1]+" %",m(n,24),n))},m=(t,o)=>{const e={dataTempValues:"",dataFullDateTimeLabels:"",dataTimeLabels:"",dataRainValues:""};e.dataTempValues=t.hourly.temperature_2m.slice(0,o),e.dataFullDateTimeLabels=t.hourly.time.slice(0,o),e.dataTimeLabels=t.hourly.time.slice(0,o).map(c=>c.slice(11,16)),e.dataRainValues=t.hourly.precipitation_probability.slice(0,o);const n=document.getElementById("forecastChart");new Chart(n,{type:"line",data:{labels:e.dataTimeLabels,datasets:[{label:"Temperature",data:e.dataTempValues,borderWidth:3,borderColor:"#ff9f40",backgroundColor:"#cc7d20"},{label:"Rain chance %",data:e.dataRainValues,borderWidth:3,borderColor:"#36a2eb",backgroundColor:"#9BD0F5"}]},options:{scales:{y:{beginAtZero:!0}}}}),document.getElementById("loading").className="global-hidden";const i=y(e.dataFullDateTimeLabels[0].slice(5,7));document.getElementById("forecast-date").innerHTML=i+","+e.dataFullDateTimeLabels[0].slice(8,10)},g=["January","February","March","April","May","June","July","August","September","October","November","December"];function y(t){return t>0&&t<=12?g[t-1]:"Error: Not a valid number"}const L=localStorage.getItem("savedLocation");if(L==null)document.getElementById("geolocationinfo").innerHTML='Press "Update" to obtain your current location.',a();else{const t=localStorage.getItem("latitude"),o=localStorage.getItem("longitude");document.getElementById("latitude").innerHTML=t,document.getElementById("longitude").innerHTML=o,document.getElementById("gotcoords").innerHTML="true",document.getElementById("geolocationinfo").innerHTML='previously saved data, you can press "update"',r(!0),l(t,o)}
