const u=document.getElementById("gotcoords"),s=new MutationObserver(function(t){t.forEach(function(n){if(n.type==="childList"){const e=document.getElementById("latitude").innerText,o=document.getElementById("longitude").innerText;m(e,o)}})});s.observe(u,{childList:!0});const i=(t="false")=>{fetch("https://ipapi.co/json/").then(e=>e.json()).then(e=>(document.getElementById("yourIP").innerHTML=e.ip,t||(document.getElementById("yourLocation").innerHTML=e.city+", "+e.country,document.getElementById("yourLocationLabel").innerHTML="Your aproximated location:",document.getElementById("latitude").innerHTML=e.latitude.toFixed(2),document.getElementById("longitude").innerHTML=e.longitude.toFixed(2),document.getElementById("gotcoords").innerHTML="true",document.getElementById("geolocationinfo").innerHTML="obtained now via IP"),e)).catch(e=>(document.getElementById("yourIP").innerHTML=e,e))},a=(t,n)=>{const e=`https://geocode.maps.co/reverse?lat=${t}&lon=${n}`;fetch(e).then(o=>o.json()).then(o=>{document.getElementById("yourLocationLabel").innerHTML="Your precise location:";const r=o.address.road==null?"":o.address.road+", ";return document.getElementById("yourLocation").innerHTML=r+o.address.city+", "+o.address.country,o})};function c(){if("geolocation"in navigator){let n=setTimeout(()=>{document.getElementById("geolocationinfo").innerHTML="Couldn't get geolocation. Check permissions on your device.",i()},1e4);navigator.geolocation.getCurrentPosition(e=>{const o=e.coords.latitude.toFixed(2),r=e.coords.longitude.toFixed(2);document.getElementById("latitude").innerHTML=o,document.getElementById("longitude").innerHTML=r,document.getElementById("gotcoords").innerHTML="true",document.getElementById("geolocationinfo").innerHTML="obtained now via geolocation",i(!0),a(e.coords.latitude,e.coords.longitude),clearTimeout(n)})}else document.getElementById("geolocationinfo").innerHTML="Geolocation not available or not allowed by user.",i();const t=document.getElementById("btGetLocation");t.disabled=!0,t.innerText="Wait ...",setTimeout(function(){t.disabled=!1,t.innerText="Update"},1e3)}document.getElementById("btGetLocation").addEventListener("click",c);const m=(t,n)=>{localStorage.setItem("savedLocation","true"),localStorage.setItem("latitude",t),localStorage.setItem("longitude",n);const e=`https://api.open-meteo.com/v1/forecast?current_weather=true&latitude=${t}&longitude=${n}&hourly=precipitation_probability&hourly=temperature_2m`;fetch(e).then(o=>o.json()).then(o=>(document.getElementById("URL").innerHTML=e,document.getElementById("temp").innerHTML=o.current_weather.temperature+" Â°C",document.getElementById("rain").innerHTML=o.hourly.precipitation_probability[1]+" %",g(o,24),o))};let l;const g=(t,n)=>{const e={dataTempValues:"",dataFullDateTimeLabels:"",dataTimeLabels:"",dataRainValues:""};e.dataTempValues=t.hourly.temperature_2m.slice(0,n),e.dataFullDateTimeLabels=t.hourly.time.slice(0,n),e.dataTimeLabels=t.hourly.time.slice(0,n).map(d=>d.slice(11,16)),e.dataRainValues=t.hourly.precipitation_probability.slice(0,n);const o=document.getElementById("forecastChart");l&&l.destroy(),l=new Chart(o,{type:"line",data:{labels:e.dataTimeLabels,datasets:[{label:"Temperature",data:e.dataTempValues,borderWidth:3,borderColor:"#ff9f40",backgroundColor:"#cc7d20"},{label:"Rain chance %",data:e.dataRainValues,borderWidth:3,borderColor:"#36a2eb",backgroundColor:"#9BD0F5"}]},options:{scales:{y:{beginAtZero:!0}}}}),document.getElementById("loading").className="global-hidden";const r=L(e.dataFullDateTimeLabels[0].slice(5,7));document.getElementById("forecast-date").innerHTML=r+","+e.dataFullDateTimeLabels[0].slice(8,10)},y=["January","February","March","April","May","June","July","August","September","October","November","December"];function L(t){return t>0&&t<=12?y[t-1]:"Error: Not a valid number"}const b=localStorage.getItem("savedLocation");if(b==null)document.getElementById("geolocationinfo").innerHTML='Press "Update" to obtain your current location.',c();else{const t=localStorage.getItem("latitude"),n=localStorage.getItem("longitude");document.getElementById("latitude").innerHTML=t,document.getElementById("longitude").innerHTML=n,document.getElementById("gotcoords").innerHTML="true",document.getElementById("geolocationinfo").innerHTML='previously saved data, press "update" to renew',i(!0),a(t,n)}
